% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/engine.R
\name{Engine}
\alias{Engine}
\title{Core Arl engine}
\description{
Core Arl engine

Core Arl engine
}
\details{
Provides class-based organization for tokenization, parsing, macro expansion,
compiled evaluation, and environment management.
}
\examples{
engine <- Engine$new()
engine$eval_text("(+ 1 2 3)")
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{tokenizer}}{Tokenizer instance used to lex source text.}

\item{\code{parser}}{Parser instance used to read expressions.}

\item{\code{macro_expander}}{Macro expander for Arl macros.}

\item{\code{compiled_runtime}}{Compiled runtime helper for executing compiled expressions.}

\item{\code{compiler}}{Compiler for AST-to-R translation.}

\item{\code{help_system}}{Help system for Arl topics.}

\item{\code{env}}{Env backing the engine.}

\item{\code{source_tracker}}{Source tracker used for error context.}

\item{\code{module_cache}}{Module cache for caching compiled modules.}

\item{\code{use_env_cache}}{Logical. If TRUE, enables the env cache (full serialized
environment) which is faster but only safe when dependencies don't change.
If FALSE (default), only the expr cache (compiled expressions) is used, which
is always safe. Can be set via engine initialization parameter or global
option \code{arl.use_env_cache}.}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-Engine-new}{\code{Engine$new()}}
\item \href{#method-Engine-read}{\code{Engine$read()}}
\item \href{#method-Engine-write}{\code{Engine$write()}}
\item \href{#method-Engine-tokenize}{\code{Engine$tokenize()}}
\item \href{#method-Engine-parse}{\code{Engine$parse()}}
\item \href{#method-Engine-eval}{\code{Engine$eval()}}
\item \href{#method-Engine-eval_in_env}{\code{Engine$eval_in_env()}}
\item \href{#method-Engine-eval_seq}{\code{Engine$eval_seq()}}
\item \href{#method-Engine-eval_exprs}{\code{Engine$eval_exprs()}}
\item \href{#method-Engine-eval_text}{\code{Engine$eval_text()}}
\item \href{#method-Engine-initialize_environment}{\code{Engine$initialize_environment()}}
\item \href{#method-Engine-load_stdlib_into_env}{\code{Engine$load_stdlib_into_env()}}
\item \href{#method-Engine-load_file}{\code{Engine$load_file()}}
\item \href{#method-Engine-load_file_in_env}{\code{Engine$load_file_in_env()}}
\item \href{#method-Engine-macroexpand}{\code{Engine$macroexpand()}}
\item \href{#method-Engine-macroexpand_in_env}{\code{Engine$macroexpand_in_env()}}
\item \href{#method-Engine-macroexpand_1}{\code{Engine$macroexpand_1()}}
\item \href{#method-Engine-macroexpand_1_in_env}{\code{Engine$macroexpand_1_in_env()}}
\item \href{#method-Engine-inspect_compilation}{\code{Engine$inspect_compilation()}}
\item \href{#method-Engine-help}{\code{Engine$help()}}
\item \href{#method-Engine-help_in_env}{\code{Engine$help_in_env()}}
\item \href{#method-Engine-repl}{\code{Engine$repl()}}
\item \href{#method-Engine-enable_coverage}{\code{Engine$enable_coverage()}}
\item \href{#method-Engine-disable_coverage}{\code{Engine$disable_coverage()}}
\item \href{#method-Engine-get_coverage}{\code{Engine$get_coverage()}}
\item \href{#method-Engine-reset_coverage}{\code{Engine$reset_coverage()}}
\item \href{#method-Engine-clone}{\code{Engine$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-new"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-new}{}}}
\subsection{Method \code{new()}}{
Initialize engine components and base environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$new(
  env = NULL,
  parent = NULL,
  use_env_cache = NULL,
  coverage_tracker = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{env}}{Optional existing environment to use. If NULL, creates a new environment.}

\item{\code{parent}}{Optional parent environment for the new environment. Only used if env is NULL.
Defaults to baseenv(). Cannot be specified together with env.}

\item{\code{use_env_cache}}{Optional logical. If TRUE, enables the env cache for 4x faster
module loading. Only safe when dependencies don't change. Defaults to NULL, which
inherits from global option \code{getOption("arl.use_env_cache", FALSE)}.}

\item{\code{coverage_tracker}}{Optional CoverageTracker instance to enable coverage tracking
from the start. If provided, coverage will be tracked during stdlib loading.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-read"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-read}{}}}
\subsection{Method \code{read()}}{
Tokenize and parse source into expressions.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$read(source, source_name = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{source}}{Character string containing Arl source.}

\item{\code{source_name}}{Optional source name for error reporting.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-write"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-write}{}}}
\subsection{Method \code{write()}}{
Convert an Arl expression to its string representation. Inverse of read().
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$write(expr)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-tokenize"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-tokenize}{}}}
\subsection{Method \code{tokenize()}}{
Tokenize source into Arl tokens.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$tokenize(source)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{source}}{Character string containing Arl source.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-parse"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-parse}{}}}
\subsection{Method \code{parse()}}{
Parse tokens into expressions.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$parse(tokens, source_name = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tokens}}{Token list produced by the tokenizer.}

\item{\code{source_name}}{Optional source name for error reporting.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-eval"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-eval}{}}}
\subsection{Method \code{eval()}}{
Evaluate a single expression via compiled evaluation.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$eval(expr)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-eval_in_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-eval_in_env}{}}}
\subsection{Method \code{eval_in_env()}}{
Evaluate a single expression in an explicit environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$eval_in_env(expr, env)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-eval_seq"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-eval_seq}{}}}
\subsection{Method \code{eval_seq()}}{
Evaluate expressions in order via compiled evaluation.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$eval_seq(exprs, env = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{exprs}}{List of Arl expressions to evaluate.}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-eval_exprs"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-eval_exprs}{}}}
\subsection{Method \code{eval_exprs()}}{
Evaluate expressions with source tracking.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$eval_exprs(exprs, env = NULL, compiled_only = TRUE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{exprs}}{List of Arl expressions to evaluate.}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}

\item{\code{compiled_only}}{Logical; if TRUE, require compiled evaluation.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-eval_text"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-eval_text}{}}}
\subsection{Method \code{eval_text()}}{
Read and evaluate text.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$eval_text(
  text,
  env = NULL,
  source_name = "<eval>",
  compiled_only = TRUE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{text}}{Character string of Arl code to read/eval.}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}

\item{\code{source_name}}{Optional source name for error reporting.}

\item{\code{compiled_only}}{Logical; if TRUE, require compiled evaluation.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-initialize_environment"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-initialize_environment}{}}}
\subsection{Method \code{initialize_environment()}}{
Populate standard bindings
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$initialize_environment()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-load_stdlib_into_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-load_stdlib_into_env}{}}}
\subsection{Method \code{load_stdlib_into_env()}}{
Load all stdlib modules in dependency order into an environment. Each module
is loaded and its exports attached into \code{env}. Used by
\code{initialize_environment()} and by the test helper for a custom env.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$load_stdlib_into_env(env)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{env}}{Environment to load stdlib into (e.g. \code{self$env$env} or a test env).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-load_file"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-load_file}{}}}
\subsection{Method \code{load_file()}}{
Load and evaluate an Arl source file in an isolated scope. The file runs in a
child of the engine's environment, so definitions and imports in the file
are not visible in the engine's main environment or to subsequent code. For
source-like behavior (definitions visible in the engine), use
\code{load_file_in_env(path, env, create_scope = FALSE)}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$load_file(path)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{File path to load.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-load_file_in_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-load_file_in_env}{}}}
\subsection{Method \code{load_file_in_env()}}{
Load and evaluate an Arl source file in an explicit environment. By default
(\code{create_scope = FALSE}) the file is evaluated in \code{env}, so definitions
and imports in the file are visible in that environment. With
\code{create_scope = TRUE}, the file runs in a child of \code{env} and its
definitions are not visible in \code{env}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$load_file_in_env(path, env, create_scope = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{File path to load.}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}

\item{\code{create_scope}}{If TRUE, evaluate in a new child of \code{env}; if FALSE, in \code{env}.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-macroexpand"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-macroexpand}{}}}
\subsection{Method \code{macroexpand()}}{
Expand macros recursively.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$macroexpand(expr, preserve_src = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}

\item{\code{preserve_src}}{Logical; keep source metadata when macroexpanding.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-macroexpand_in_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-macroexpand_in_env}{}}}
\subsection{Method \code{macroexpand_in_env()}}{
Expand macros recursively in an explicit environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$macroexpand_in_env(expr, env, preserve_src = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}

\item{\code{preserve_src}}{Logical; keep source metadata when macroexpanding.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-macroexpand_1"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-macroexpand_1}{}}}
\subsection{Method \code{macroexpand_1()}}{
Expand a single macro layer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$macroexpand_1(expr, preserve_src = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}

\item{\code{preserve_src}}{Logical; keep source metadata when macroexpanding.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-macroexpand_1_in_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-macroexpand_1_in_env}{}}}
\subsection{Method \code{macroexpand_1_in_env()}}{
Expand a single macro layer in an explicit environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$macroexpand_1_in_env(expr, env, preserve_src = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{expr}}{Arl expression (symbol/call/atomic value).}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}

\item{\code{preserve_src}}{Logical; keep source metadata when macroexpanding.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-inspect_compilation"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-inspect_compilation}{}}}
\subsection{Method \code{inspect_compilation()}}{
Inspect expansion and compilation for debugging. Parse text, expand macros in env,
then compile to R. Returns parsed AST, expanded form, compiled R expression, and
deparsed R code so you can see exactly what an Arl program becomes.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$inspect_compilation(text, env = NULL, source_name = "<inspect>")}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{text}}{Character; Arl source (single expression or multiple).}

\item{\code{env}}{Environment or NULL (use engine env). Must have macros/stdlib if needed.}

\item{\code{source_name}}{Name for parse errors.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List with \code{parsed} (first expr), \code{expanded}, \code{compiled} (R expr or NULL), \code{compiled_deparsed} (character, or NULL).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-help"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-help}{}}}
\subsection{Method \code{help()}}{
Show help for a topic.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$help(topic)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{topic}}{Help topic as a single string.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-help_in_env"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-help_in_env}{}}}
\subsection{Method \code{help_in_env()}}{
Show help for a topic in an explicit environment.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$help_in_env(topic, env)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{topic}}{Help topic as a single string.}

\item{\code{env}}{Optional environment or Env used as the engine base.}

\item{\code{env}}{Optional environment or Env to evaluate in (defaults to engine env).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-repl"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-repl}{}}}
\subsection{Method \code{repl()}}{
Start the Arl REPL using this engine.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$repl()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-enable_coverage"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-enable_coverage}{}}}
\subsection{Method \code{enable_coverage()}}{
Enable coverage tracking.

Creates a coverage tracker and installs it in the eval context.
Should be called before running code you want to track.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$enable_coverage()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
The coverage tracker instance
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-disable_coverage"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-disable_coverage}{}}}
\subsection{Method \code{disable_coverage()}}{
Disable coverage tracking.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$disable_coverage()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-get_coverage"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-get_coverage}{}}}
\subsection{Method \code{get_coverage()}}{
Get coverage data.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$get_coverage()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Coverage tracker instance, or NULL if not enabled
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-reset_coverage"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-reset_coverage}{}}}
\subsection{Method \code{reset_coverage()}}{
Reset coverage data.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$reset_coverage()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-Engine-clone"></a>}}
\if{latex}{\out{\hypertarget{method-Engine-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{Engine$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
