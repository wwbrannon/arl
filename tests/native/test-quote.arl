;; Native tests for quote and quasiquote
;; Tests quote, quasiquote, unquote, and unquote-splicing

;; Basic quote

(define test-quote-symbol (lambda ()
  (define quoted (quote a))
  (assert-equal (quote a) quoted)))

(define test-quote-number (lambda ()
  (define quoted (quote 42))
  (assert-equal 42 quoted)))

(define test-quote-list (lambda ()
  (define quoted-list (quote (1 2 3)))
  ;; Verify list structure is preserved
  (assert-equal 3 (length quoted-list))
  (assert-equal 1 (car quoted-list))
  (assert-equal 2 (car (cdr quoted-list)))
  (assert-equal 3 (car (cdr (cdr quoted-list))))))

(define test-quote-shorthand (lambda ()
  ;; Test that 'a is equivalent to (quote a)
  (assert-equal 'a (quote a))
  (assert-equal '(1 2) (quote (1 2)))))

;; Basic quasiquote

(define test-quasiquote-basic (lambda ()
  (define result `(1 2 3))
  ;; Quasiquote without unquote behaves like quote
  (assert-equal 3 (length result))
  (assert-equal 1 (car result))))

(define test-quasiquote-with-unquote (lambda ()
  (define x 5)
  (define y 10)
  (define result `(1 ,x 3 ,y))
  ;; Result should be (1 5 3 10) after unquote evaluation
  (assert-equal 1 (car result))
  (assert-equal 5 (car (cdr result)))
  (assert-equal 3 (car (cdr (cdr result))))
  (assert-equal 10 (car (cdr (cdr (cdr result)))))))

;; Unquote-splice tests

(define test-unquote-splice-basic (lambda ()
  (define nums (quote (2 3 4)))
  (define result `(1 ,@nums 5))
  ;; Result should be (1 2 3 4 5) after splice
  (assert-equal 5 (length result))
  (assert-equal 1 (car result))
  (assert-equal 2 (car (cdr result)))
  (assert-equal 5 (car (cdr (cdr (cdr (cdr result))))))))

(define test-unquote-splice-empty (lambda ()
  (define result `(a ,@(quote ()) b))
  ;; Empty list should splice to nothing: (a b)
  (assert-equal 2 (length result))
  (assert-equal (quote a) (car result))
  (assert-equal (quote b) (car (cdr result)))))

(define test-unquote-splice-multiple (lambda ()
  (define xs (quote (1 2)))
  (define ys (quote (3 4)))
  (define result `(,@xs ,@ys))
  ;; Should be (1 2 3 4)
  (assert-equal 4 (length result))
  (assert-equal 1 (car result))
  (assert-equal 4 (car (cdr (cdr (cdr result)))))))

;; Nested quasiquote tests

(define test-nested-quasiquote-simple (lambda ()
  (define x 5)
  ;; Test basic nested quasiquote - `(a ,x) within another quasiquote
  (define result `(a ,x))
  ;; Should evaluate to (a 5)
  (assert-equal (quote a) (car result))
  (assert-equal 5 (car (cdr result)))))
