;; Native tests for list operations - User-facing examples
;; For comprehensive edge case testing, see tests/testthat/test-stdlib-list.R
;; These tests demonstrate idiomatic usage patterns with simple examples.

(import sort)

;; ============================================================================
;; Association Lists
;; ============================================================================

(define test-assoc-basic (lambda ()
  (define alist (list (list 'a 1) (list 'b 2) (list 'c 3)))
  (assert-equal (assoc 'b alist) (list 'b 2))
  (assert-equal (assoc 'z alist) #nil)))

(define test-assoc-by-== (lambda ()
  ;; assoc-by-== uses R's == (numeric/coercing equality)
  (define alist (list (list 1 "one") (list 2 "two") (list 3 "three")))
  (assert-equal (assoc-by-== 1 alist) (list 1 "one"))
  (assert-equal (assoc-by-== 1L alist) (list 1 "one"))))

(define test-rassoc-basic (lambda ()
  ;; rassoc searches by value (cdr of pair)
  (define alist (list (list 'a 1) (list 'b 2) (list 'c 3)))
  (assert-equal (rassoc 2 alist) (list 'b 2))
  (assert-equal (rassoc 99 alist) #nil)))

;; ============================================================================
;; Sorting
;; ============================================================================

(define test-sort-basic (lambda ()
  (define unsorted (list 3 1 4 1 5 9 2 6))
  (define sorted (list 1 1 2 3 4 5 6 9))
  (assert-equal (list-sort unsorted <) sorted)
  (assert-equal (list-sort (list 3 1 4 1 5) >) (list 5 4 3 1 1))))

(define test-sort-by-length (lambda ()
  ;; Sort strings by length
  (define words (list "hello" "hi" "goodbye" "bye"))
  (define sorted (list "hi" "bye" "hello" "goodbye"))
  (assert-equal (sort-by words string-length <) sorted)))

(define test-merge-sorted-lists (lambda ()
  (define list1 (list 1 3 5 7))
  (define list2 (list 2 4 6 8))
  (define merged (list 1 2 3 4 5 6 7 8))
  (assert-equal (merge-sorted list1 list2 <) merged)))

(define test-stable-sort-preserves-order (lambda ()
  ;; When elements are equal, preserve original order
  (define pairs (list (list 1 "a") (list 2 "b") (list 1 "c") (list 2 "d")))
  (define sorted (stable-sort pairs (lambda (a b) (< (car a) (car b)))))
  ;; First elements with key 1 should be (1 "a") then (1 "c")
  (assert-equal (car sorted) (list 1 "a"))
  (assert-equal (car (cdr sorted)) (list 1 "c"))))

;; ============================================================================
;; List Generation
;; ============================================================================

(define test-range-basic (lambda ()
  (assert-equal (range 0 5) (list 0 1 2 3 4))
  (assert-equal (range 3 7) (list 3 4 5 6))))

(define test-range-with-step (lambda ()
  (assert-equal (range 0 10 2) (list 0 2 4 6 8))
  (assert-equal (range 10 0 -2) (list 10 8 6 4 2))))

(define test-iota-basic (lambda ()
  ;; iota n generates 0, 1, ..., n-1
  (assert-equal (iota 5) (list 0 1 2 3 4))))

(define test-iota-with-start-and-step (lambda ()
  ;; iota count start generates start, start+1, ..., start+n-1
  (assert-equal (iota 5 10) (list 10 11 12 13 14))
  ;; iota count start step
  (assert-equal (iota 5 0 2) (list 0 2 4 6 8))))

(define test-make-list-basic (lambda ()
  (define result (make-list 3 'x))
  (assert-equal result (list 'x 'x 'x))
  (assert-equal (make-list 4 0) (list 0 0 0 0))))

;; ============================================================================
;; Additional List Accessors
;; ============================================================================

(define test-list-ref-zero-indexed (lambda ()
  (define lst (list 'a 'b 'c 'd))
  (assert-equal (list-ref lst 0) 'a)
  (assert-equal (list-ref lst 2) 'c)))

(define test-list-tail-drop (lambda ()
  (define lst (list 1 2 3 4 5))
  (assert-equal (list-tail lst 2) (list 3 4 5))
  (assert-equal (list-tail (list 1 2 3) 3) (list))))
