;; Native tests for I/O operations - User-facing examples
;; For comprehensive edge case testing, see tests/testthat/test-stdlib-io.R
;; These tests demonstrate idiomatic usage patterns with simple examples.

;; ============================================================================
;; Parsing (read)
;; ============================================================================

(define test-read-basic (lambda ()
  (assert-equal (read "42") 42)
  (assert-equal (read "foo") 'foo)
  (assert-equal (read "\"hello world\"") "hello world")))

(define test-read-list (lambda ()
  (define expr (read "(+ 1 2 3)"))
  (assert-true (list? expr))
  (assert-equal (car expr) '+)))

(define test-read-from-string-alias (lambda ()
  ;; read-from-string is alias for read
  (define expr (read-from-string "(* 2 3)"))
  (assert-equal (car expr) '*)))

;; ============================================================================
;; Output Functions
;; ============================================================================

;; Note: Testing print/newline/write-string is tricky as they produce side effects
;; We test that they at least execute without error

(define test-output-functions (lambda ()
  ;; These functions handle output to stdout/files
  (assert-true (fn? print))
  (assert-true (fn? newline))
  (assert-true (fn? write-string))))

;; ============================================================================
;; File System Operations
;; ============================================================================

;; For actual file operations, we would need test fixtures.
;; Here we just ensure the functions are defined and callable.
;; Comprehensive I/O tests with fixtures are in test-stdlib-io.R

(define test-file-operations-exist (lambda ()
  (assert-true (fn? file-size))
  (assert-true (fn? file-modified-time))
  (assert-true (fn? directory-list))
  (assert-true (fn? file-delete))
  (assert-true (fn? directory-exists?))))

;; ============================================================================
;; Environment Variables
;; ============================================================================

(define test-getenv-home (lambda ()
  ;; HOME should exist on Unix-like systems
  (define home (getenv "HOME"))
  (if (not (nil? home))
    (assert-true (string? home))
    (assert-true #t))))  ;; Skip on systems without HOME

(define test-setenv-getenv-roundtrip (lambda ()
  ;; Set an env var and read it back
  (setenv "ARL_TEST_VAR" "test-value")
  (assert-equal (getenv "ARL_TEST_VAR") "test-value")))

;; ============================================================================
;; System Operations
;; ============================================================================

(define test-exit-exists (lambda ()
  ;; Don't actually call exit! Just verify it exists
  (assert-true (fn? exit))))

(define test-system (lambda ()
  ;; System command execution - test with harmless command
  (assert-true (fn? system))
  (define result (system "true"))  ;; 'true' always succeeds
  (assert-true (if (number? result) #t #f))))
